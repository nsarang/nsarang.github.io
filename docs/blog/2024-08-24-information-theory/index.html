<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nima Sarang">
<meta name="dcterms.date" content="2024-08-24">
<meta name="description" content="A brief overview of Information Theory concepts that I compiled for my own reference.">

<title>My Notes on Information Theory – Nima Sarang</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../_assets/favicon.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-HWSGHN8N8N"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-HWSGHN8N8N', { 'anonymize_ip': true});
</script>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;700&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Petrona:wght@400;500&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Red+Hat+Text:ital,wght@0,400;0,500;1,400;1,500&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=B612:ital,wght@0,400;0,700;1,400;1,700&amp;family=B612+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet">

<link href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&amp;display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="My Notes on Information Theory">
<meta property="og:description" content="A brief overview of Information Theory concepts that I compiled for my own reference.">
<meta property="og:image" content="https://www.nimasarang.com/blog/2024-08-24-information-theory/featured.png">
<meta property="og:site_name" content="Nima Sarang">
<meta property="og:image:height" content="666">
<meta property="og:image:width" content="1480">
<meta name="twitter:title" content="My Notes on Information Theory">
<meta name="twitter:description" content="A brief overview of Information Theory concepts that I compiled for my own reference.">
<meta name="twitter:image" content="https://www.nimasarang.com/blog/2024-08-24-information-theory/featured.png">
<meta name="twitter:image-height" content="666">
<meta name="twitter:image-width" content="1480">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../_assets/favicon.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Nima Sarang</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about/index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../project/index.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publication/index.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://www.github.com/nsarang" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://www.linkedin.com/in/nima-sarang" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns">
<div id="title-block-header-title" class="quarto-title page-columns page-full page-layout-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg); background-repeat: no-repeat;">
<h1 class="title">My Notes on Information Theory</h1>
    <div class="quarto-categories">
        <div class="quarto-category">ML</div>
        <div class="quarto-category">Information Theory</div>
      </div>
  </div>

<div>
  <div id="title-block-title-desc" class="description pt-4">
    A brief overview of Information Theory concepts that I compiled for my own reference.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nima Sarang </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 24, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 15, 2024</p>
    </div>
  </div>
    
  </div>
  



</header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="1">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#entropy" id="toc-entropy" class="nav-link" data-scroll-target="#entropy"><span class="header-section-number">2</span> Entropy</a>
  <ul class="collapse">
  <li><a href="#information-content" id="toc-information-content" class="nav-link" data-scroll-target="#information-content"><span class="header-section-number">2.1</span> Information Content</a></li>
  <li><a href="#shannon-entropy" id="toc-shannon-entropy" class="nav-link" data-scroll-target="#shannon-entropy"><span class="header-section-number">2.2</span> Shannon Entropy</a></li>
  <li><a href="#a-bit-of-history" id="toc-a-bit-of-history" class="nav-link" data-scroll-target="#a-bit-of-history"><span class="header-section-number">2.3</span> A bit of history</a></li>
  </ul></li>
  <li><a href="#cross-entropy" id="toc-cross-entropy" class="nav-link" data-scroll-target="#cross-entropy"><span class="header-section-number">3</span> Cross Entropy</a></li>
  <li><a href="#kullbackleibler-divergence" id="toc-kullbackleibler-divergence" class="nav-link" data-scroll-target="#kullbackleibler-divergence"><span class="header-section-number">4</span> Kullback–Leibler Divergence</a>
  <ul class="collapse">
  <li><a href="#non-negativity" id="toc-non-negativity" class="nav-link" data-scroll-target="#non-negativity"><span class="header-section-number">4.1</span> Non-Negativity</a></li>
  <li><a href="#sec-zero-prob" id="toc-sec-zero-prob" class="nav-link" data-scroll-target="#sec-zero-prob"><span class="header-section-number">4.2</span> At Zero Probabilities</a></li>
  <li><a href="#reverse-kl-vs-forward-kl" id="toc-reverse-kl-vs-forward-kl" class="nav-link" data-scroll-target="#reverse-kl-vs-forward-kl"><span class="header-section-number">4.3</span> Reverse KL vs Forward KL</a></li>
  <li><a href="#relations-to-mutual-information" id="toc-relations-to-mutual-information" class="nav-link" data-scroll-target="#relations-to-mutual-information"><span class="header-section-number">4.4</span> Relations to Mutual Information</a></li>
  </ul></li>
  <li><a href="#jensen-shannon-divergence" id="toc-jensen-shannon-divergence" class="nav-link" data-scroll-target="#jensen-shannon-divergence"><span class="header-section-number">5</span> Jensen-Shannon Divergence</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">
<style>
  body {
    visibility: hidden; /* initially hidden until DOM ready to prevent flicker */
  }
</style>
<noscript>
  <style>
    body {
      visibility: visible !important; /* Override hidden state when JS is disabled */
    }
  </style>
</noscript>

<!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html -->
<!-- 
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"> 
-->
<!-- <header id="title-block-header" class="quarto-title-block default page-columns"> -->
<!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> -->



<div class="hidden">
% Meta %
<p>% Optional argument [#1]: Size modifier (e.g., , ) % #2: Opening delimiter % #3: Closing delimiter % #4: Content</p>
<p>% Common sets % Real numbers % Integers % Natural numbers % Rational numbers % Complex numbers</p>
<p>% Probability and statistics % Expectation % Variance % Covariance % Probability measure % Indicator function</p>
% Linear algebra
% Matrix
<p>% Vector % Trace % Rank % Range (image) % Projection</p>
% Calculus and analysis % For integrals, e.g., f(x) x
% Partial derivative \newcommand{[2]}{ #1} % Partial derivative w/o fraction
<p>% Second partial derivative % Gradient % Divergence % Curl</p>
% Set theory
% Set
<p>% Set builder notation % Union % Intersection % Symmetric difference</p>
<p>% Logic and proofs % Implies % If and only if % End of proof % Contradiction</p>
% Norms and inner products
% Norm
<p>% Inner product</p>
<p>% Common functions % Minimization problem % Maximization problem % Argument minimum % Argument maximum</p>
<p>% Subject to constraints % Sign function % Span of a set</p>
% Formatting
% Absolute value
% Parentheses
% Brackets
% Floor function
<p>% Ceiling function</p>
<p>% Asymptotic notations % Big O notation % Small o notation % Big Omega notation % Big Theta notation</p>
<p>% Commonly used in algorithms and complexity % Polynomial time % Polylogarithmic time</p>
<p>% Additional probability notations % Independent and identically distributed % Distributed as</p>
<p>% Fourier transform % Fourier transform % Inverse Fourier transform</p>
<p>% General math % Display style</p>
</div>
<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>Every now and then, I find myself revisiting the basics of Information Theory when reading on papers about VAEs, GANs, or other generative models. I decided to compile a brief overview of the concepts for my own reference. So take it with a grain of salt, as it’s not meant to be a comprehensive guide.</p>
<p>I’ll update this post as I learn more about the topic, so stay tuned!</p>
</section>
<section id="entropy" class="level2" data-number="2">
<h2 data-number="2" data-anchor-id="entropy"><span class="header-section-number">2</span> Entropy</h2>
<p>Entropy is a fundamental concept in information theory that quantifies the <strong>uncertainty</strong> or <strong>randomness</strong> in a system. Let’s consider a couple of examples:</p>
<p>Imagine you’re trying to guess the next card drawn from a deck. With a well-shuffled deck, each draw is <em>unpredictable</em> – this scenario has <em>high</em> entropy. On the other hand, if the cards were arranged in a known order, each draw would be predictable – this has low entropy.</p>
<p>Now, let’s think about weather prediction. In a climate where it rains 90% of the days, guessing that it will rain tomorrow is usually correct but not very informative. This scenario has lower entropy than a climate where rain and sun are equally likely (50% each), making predictions more challenging and uncertain.</p>
<section id="information-content" class="level3" data-number="2.1">
<h3 data-number="2.1" data-anchor-id="information-content"><span class="header-section-number">2.1</span> Information Content</h3>
<p>We quantify the uncertainty or information content of an event <span class="math inline">\(x\)</span> with probability <span class="math inline">\(p(x)\)</span> as:</p>
<p><span class="math display">\[I(x) = -\log_2{p(x)}\]</span></p>
<p>It measures the surprise or “news value” of observing event <span class="math inline">\(x\)</span>. <span class="math inline">\(I(x)\)</span> is also reffered to as the number of bits needed to encode the event, but we’ll get to that later.</p>
<p>Why use <span class="math inline">\(-\log p\)</span>? Let’s visualize it:</p>
<div id="cell-fig-log-ic" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<div id="fig-log-ic" class="quarto-float quarto-figure quarto-figure-center" width="585" height="429">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-log-ic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-log-ic-output-1.png" id="fig-log-ic" width="585" height="429" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-log-ic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
</figcaption>
</figure>
</div>
</div>
</div>
<p>This function captures several intuitive properties:</p>
<ol type="1">
<li>Rare events (low <span class="math inline">\(p\)</span>) have higher information content, as <span class="math inline">\(\displaystyle{\lim_{p \to 0^+} (-\log{p}) = +\infty}.\)</span></li>
<li>Certain events (<span class="math inline">\(p = 1\)</span>) have zero information content.</li>
<li>The negative sign ensures positive values.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled" title="Boltzmann's Entropy">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Boltzmann’s Entropy
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>It seems that the idea of using natual logarithm in entropy was first introduced by Boltzmann in the context of thermodynamics <span class="citation" data-cites="wiki2024_boltzmann_entropy"><a href="#ref-wiki2024_boltzmann_entropy" role="doc-biblioref">[1]</a></span>. I’m interested to read on this later.</p>
</div>
</div>
</div>
</section>
<section id="shannon-entropy" class="level3" data-number="2.2">
<h3 data-number="2.2" data-anchor-id="shannon-entropy"><span class="header-section-number">2.2</span> Shannon Entropy</h3>
<p>Shannon entropy is the expected value (weighted average) of information content across all possible events in a probability distribution:</p>
<p><span id="eq-entropy"><span class="math display">\[H(X) = \mathbb{E}[-\log p(X)] = -\sum_x p(x) \log{p(x)} \tag{1}\]</span></span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>If <span class="math inline">\(p(x) = 0\)</span>, then <span class="math inline">\(p(x)\log{p(x)} = 0\times\log{0} \boldsymbol{= 0}\)</span>. This is because <span class="math inline">\(\displaystyle{\lim_{x \to 0^+} x\log{x} = 0}\)</span> and can be proven using L’Hôpital’s rule <span class="citation" data-cites="wiki2024_lhopitals_rule"><a href="#ref-wiki2024_lhopitals_rule" role="doc-biblioref">[2]</a></span>:<br>
<span class="math inline">\(\displaystyle{\lim_{x \to 0^+} x\log{x} = 0 = \lim_{x \to 0^+} \frac{\log{x}}{1/x} \;\xlongequal{\text{L'Hôpital}}\; \lim_{x \to 0^+} \frac{1/x}{-1/x^2} = \lim_{x \to 0^+} -x = 0}\)</span></p>
</div>
</div>
</div>
<p>To put this into perspective, English text typically has an entropy of about 1-1.5 bits per character. In comparison, a random string of characters over the same alphabet has an entropy of <span class="math display">\[\mathbb{E}[-\log_2{p(X)}] = -\sum\limits_{i=1}^{26} \frac{1}{26} \log_2(\frac{1}{26}) = \log_2(26) \approx 4.7\]</span> bits per character.</p>
<p>This concept has practical applications in various fields. For instance, in cybersecurity, a truly random string of characters (like a strong password) approaches the maximum entropy of <span class="math inline">\(\log_2(n)\)</span> bits per character, where <span class="math inline">\(n\)</span> is the number of possible characters. The password <em>“password123”</em> has low entropy and is easily guessable, while <em>“Tr0ub4dor&amp;Co”</em> has higher entropy and is more secure. This difference in entropy reflects the varying degrees of unpredictability and, consequently, the strength of these passwords.</p>
</section>
<section id="a-bit-of-history" class="level3" data-number="2.3">
<h3 data-number="2.3" data-anchor-id="a-bit-of-history"><span class="header-section-number">2.3</span> A bit of history</h3>
<p>The terms “coding” and “encoded” in information theory stem from Claude Shannon’s work on efficient information transmission over noisy channels. Entropy <span class="math inline">\(H(X)\)</span> represents the theoretical lower bound on the average number of bits needed to encode symbols from a source, which is why we measure it in bits (using log base 2) - it directly relates to optimal coding length.</p>
<p>Shannon’s Source Coding Theorem formalizes this: no lossless compression can exceed this efficiency on average. This explains why English text (~1.5 bits of entropy per character) compresses far more than random text (~4.7 bits per character), and why compression algorithms excel with natural language but struggle with random data. Understanding entropy as a limit on coding efficiency makes it a powerful tool across various domains like data compression, cryptography, and machine learning.</p>
</section>
</section>
<section id="cross-entropy" class="level2" data-number="3">
<h2 data-number="3" data-anchor-id="cross-entropy"><span class="header-section-number">3</span> Cross Entropy</h2>
<p>Imagine you have a source that produces messages according to a true distribution <span class="math inline">\(P\)</span>, but you’re using a different distribution <span class="math inline">\(Q\)</span> to encode these messages. Cross-entropy measures the average number of bits you’ll need using this possibly inefficient encoding.</p>
<p>For example, consider describing a language you’ve never seen before. You start by guessing how often each letter appears.</p>
<ul>
<li>The true frequency (<span class="math inline">\(P\)</span>) of letters in this language is: <span class="math inline">\(A: 40\%, \; B: 40\%, \; C: 20\%\)</span></li>
<li>Your initial guess (<span class="math inline">\(Q\)</span>) is: <span class="math inline">\(A: 60\%, \; B: 30\%, \; C: 10\%\)</span></li>
</ul>
<p>Now, let’s use your guess to “encode” messages in this language, i.e., calculate its uncertainty:</p>
<ol type="1">
<li>For each ‘A’, we use <span class="math inline">\(-\log_2{0.6} \approx 0.74\)</span> bits</li>
<li>For each ‘B’, we use <span class="math inline">\(-\log_2{0.3} \approx 1.74\)</span> bits</li>
<li>For each ‘C’, we use <span class="math inline">\(-\log_2{0.1} \approx 3.32\)</span> bits</li>
</ol>
<p>To calculate the average number of bits per letter, we use <span class="math inline">\(P\)</span>’s frequencies because that’s how often each letter actually appears, while <span class="math inline">\(Q\)</span> determines the cost for each letter. This combination tells us the real-world performance of our encoding scheme.</p>
<p><span class="math display">\[ \left(0.4 \times 0.74\right) + \left(0.4 \times 1.74\right) + \left(0.2 \times 3.32\right) \approx 1.57 \text{ bits per letter}\]</span></p>
<p>The resulting average, <span class="math inline">\(H(P,Q) \approx 1.57\)</span> bits, represents the typical encoding cost per letter when our guess (<span class="math inline">\(Q\)</span>) is used to encode messages that actually follow the true distribution (<span class="math inline">\(P\)</span>).</p>
<p>This approach mirrors how we evaluate predictions in ML: Our model makes guesses (Q), but the world behaves according to the true probabilities (P). Cross-entropy quantifies the average encoding length under this scenario.</p>
<p><strong>Formal Definition:</strong></p>
<p>The cross-entropy between two probability distributions <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> over the same underlying set of events measures the average number of bits needed to identify an event drawn from the set, if a coding scheme used for the set is optimized for an estimated probability distribution <span class="math inline">\(q\)</span>, rather than the true distribution <span class="math inline">\(p\)</span>.</p>
<p><span id="eq-cross-entropy"><span class="math display">\[H(P, Q) = -\sum\limits_{x \in X} p(x)\log{q(x)} = \mathbb{E}_{x \sim P}[-\log{q(x)}] \tag{2}\]</span></span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>If <span class="math inline">\(p(x) &gt; 0\)</span> and <span class="math inline">\(q(x) = 0\)</span> for some <span class="math inline">\(x\)</span>, then <span class="math inline">\(p(x)\log{q(x)}\)</span> is undefined becuase of <span class="math inline">\(\log{0}\)</span>. To address this we can add a small epsilon to <span class="math inline">\(q(x)\)</span> to avoid <span class="math inline">\(\log{0}\)</span>. In fact, this is a common practice in ML libraries.</p>
</div>
</div>
</div>
<p><strong>Binary Cross-Entropy:</strong></p>
<ul>
<li><p>In binary classification, we deal with two classes, and the predicted probability for one class inherently determines the probability for the other. If <span class="math inline">\(q\)</span> is the predicted probability of the positive class (class 1), then <span class="math inline">\(1-q\)</span> is the probability of the negative class (class 0). The binary cross-entropy loss combines the log-likelihood terms for both possible classes (positive and negative) into a single expression. For a single data point, it is defined as:</p>
<p><span class="math display">\[-\left[y\,log(q)\;+\;(1−y)\,log(1−q)\right]\]</span></p></li>
</ul>
</section>
<section id="kullbackleibler-divergence" class="level2 page-columns page-full" data-number="4">
<h2 data-number="4" data-anchor-id="kullbackleibler-divergence"><span class="header-section-number">4</span> Kullback–Leibler Divergence</h2>
<p>To measure the expected number of extra bits required to code samples from <span class="math inline">\(P\)</span> using a code optimized for <span class="math inline">\(Q\)</span> rather than the code optimized for <span class="math inline">\(P\)</span>, we use the Kullback-Leibler divergence. It</p>
<p><span id="eq-kl-divergence"><span class="math display">\[
\begin{aligned}
D_{KL}(P \;\Vert\; Q) &amp;= H(P, Q) - H(P) &amp;&amp; \hspace{-2em}\text{\small{(extra bits to code $P$ using $Q$)}} \\[3ex]
&amp;= \mathbb{E}_{x \sim P}[-\log q(x)] - \mathbb{E}_{x \sim P}[-\log p(x)] \\[3ex]
&amp;= -\sum\limits_{x \in X} p(x)\log{q(x)} + \sum\limits_{x \in X} p(x)\log{p(x)} \\[1ex]
&amp;= \sum\limits_{x \in X} p(x)\log{\frac{p(x)}{q(x)}} &amp;&amp; \hspace{-2em}\text{\small{(as $\log{a} - \log{b} = \log{\frac{a}{b}}$)}}
\end{aligned}
\tag{3}\]</span></span></p>
<p>The relative entropy <span class="math inline">\({D_{\text{KL}}(P\parallel Q)}\)</span> quantifies how far the distribution <span class="math inline">\(Q\)</span> is from the distribution <span class="math inline">\(P\)</span>. The cross-entropy alone cannot be thought of as a distance, since <span class="math inline">\({H(P,P)=:H(P)}\)</span> isn’t zero. This can be fixed by subtracting <span class="math inline">\({H(P)}\)</span> to make <span class="math inline">\({D_{\text{KL}}(P\parallel Q)}\)</span> agree more closely with our notion of distance, as the <em>excess loss</em>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>KL divergence is asymmetric, i.e.&nbsp;<span class="math inline">\({D_{\text{KL}}(P\parallel Q)\neq D_{\text{KL}}(Q\parallel P)}\)</span> except when <span class="math inline">\(P = Q\)</span>.</p>
</div>
</div>
</div>
<section id="non-negativity" class="level3" data-number="4.1">
<h3 data-number="4.1" data-anchor-id="non-negativity"><span class="header-section-number">4.1</span> Non-Negativity</h3>
<p>If <span class="math inline">\(Q = P\)</span>, then <span class="math inline">\(D_{KL}(P \;\Vert\; P) = H(P, P) - H(P) = 0\)</span>. But is zero the lower bound for <span class="math inline">\(D_{KL}\)</span>? Basically the question is whether: <span class="math display">\[H(P, Q) \stackrel{?}{\geq} H(P) \quad \forall P, Q\]</span></p>
<p>This is known as Gibbs’ inequality, and it’s a fundamental property of the Kullback-Leibler divergence. It tells us that if you try to use a probability distribution <span class="math inline">\(Q\)</span> to encode data that actually follows a different distribution <span class="math inline">\(P\)</span>, you will always need more bits on average, compared to using <span class="math inline">\(P\)</span> itself.</p>
<p>To prove <span class="math inline">\(D_{KL}(P \;\Vert\; Q) \stackrel{?}{\ge} 0\)</span>, we can use the fact that <span class="math inline">\(-\log\)</span> is a convex function (see <a href="#fig-log-ic" class="quarto-xref">Figure&nbsp;1</a>). By Jensen’s inequality, we have:</p>
<p><span class="math display">\[
\begin{aligned}
\sum\limits_{x} p(x)\log{\frac{p(x)}{q(x)}} &amp;= \sum\limits_{x} p(x)\times -\log{\frac{q(x)}{p(x)}} \\[2ex]
&amp;\ge -\log\left(\sum_{x} p(x) {\frac{q(x)}{p(x)}}\right) &amp;&amp; \text{\small{(Jensen's inequality)}} \\[2ex]
&amp;= -\log\left(\sum_{x} q(x)\right) = -\log {1} &amp;&amp; \text{\small{(sum of probabilities = 1)}} \\[2ex]
&amp; = 0
\end{aligned}
\]</span> <span class="math display">\[ \therefore \quad D_{KL}(P \;\Vert\; Q) \ge 0\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Jensen’s Inequality
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Jensen’s inequality states that for a convex function <span class="math inline">\(f\)</span> and a random variable <span class="math inline">\(X\)</span>:</p>
<p><span class="math display">\[f(\mathbb{E}[X]) \leq \mathbb{E}[f(X)]\]</span></p>
<p>Similarly, for a concave function <span class="math inline">\(f\)</span>: <span class="math display">\[f(\mathbb{E}[X]) \geq \mathbb{E}[f(X)]\]</span></p>
</div>
</div>
</div>
</section>
<section id="sec-zero-prob" class="level3" data-number="4.2">
<h3 data-number="4.2" data-anchor-id="sec-zero-prob"><span class="header-section-number">4.2</span> At Zero Probabilities</h3>
<p>Let’s consider the cases where <span class="math inline">\(p(x) = 0\)</span> or <span class="math inline">\(q(x) = 0\)</span>, because it’ll be useful later on:</p>
<ol type="1">
<li><p><span class="math inline">\(p(𝑋)=0 \text{ and } q(𝑋)\gt 0\)</span>:<br>
As a result, <span class="math inline">\(\displaystyle\lim_{p \to 0} p\log{p} = 0\)</span>. This makes sense since we sample according to distribution <span class="math inline">\(p\)</span>, we’ll never sample event <span class="math inline">\(x\)</span>. Hence, it does not weight in <span class="math inline">\({D_{KL}(P \;\Vert\; Q)}\)</span>, meaning <span class="math inline">\(Q\)</span> can make mistakes about events that <span class="math inline">\(P\)</span> considers impossible without penalty.<br></p></li>
<li><p><span class="math inline">\(p(𝑋)\gt 0 \text{ and } q(𝑋)= 0\)</span>:<br>
Then&nbsp;<span class="math inline">\(\displaystyle\lim_{q \to 0^+} \log{\frac{1}{q}} = +\infty\)</span>. An infinite divergence effectively signals that the model <span class="math inline">\(Q\)</span> fails to account for an event <span class="math inline">\(x\)</span> that is observed under <span class="math inline">\(P\)</span>.<br></p></li>
<li><p><span class="math inline">\(p(𝑋)=0 \text{ and } q(𝑋)= 0\)</span>: Then it’s really undefined :)</p></li>
</ol>
</section>
<section id="reverse-kl-vs-forward-kl" class="level3 page-columns page-full" data-number="4.3">
<h3 data-number="4.3" data-anchor-id="reverse-kl-vs-forward-kl"><span class="header-section-number">4.3</span> Reverse KL vs Forward KL</h3>
<p>This is something that I had never thought about before, because I had only seen KL divergence in the context of variational inference. But it turns out that there are two ways to use KL divergence in an optimization problem. We had previously established that <span class="math inline">\(D_{KL}\)</span> is asymmetric. This means that minimizing <span class="math inline">\(D_{KL}(P \;\Vert\; Q)\)</span> is not the same as minimizing <span class="math inline">\(D_{KL}(Q \;\Vert\; P)\)</span>. The former is known as the <em>Forward KL</em> and the latter is known as the <em>Reverse KL</em>. The practical difference between the two arises when the model cannot perfectly fit the true distribution, which is most often the case. This is where the two divergences diverge (pun intended).</p>
<p>Let’s say we have a model <span class="math inline">\(Q\)</span> that we want to optimize to approximate the true distribution <span class="math inline">\(P\)</span>. It’d be fair assumption that <span class="math inline">\(P\)</span> would be a more complex distribution than <span class="math inline">\(Q\)</span>, with more modes and a more complex structure, since <span class="math inline">\(Q\)</span> is a simpler model. As example, <span class="math inline">\(P\)</span> could be a Gaussian mixture model with 10 components (multimodal), while <span class="math inline">\(Q\)</span> is a single Gaussian (unimodal).</p>
<section id="forward-kl" class="level4 page-columns page-full">
<h4 data-anchor-id="forward-kl"><strong>Forward KL</strong></h4>
<p><span class="math inline">\(D_{KL}(P \;\Vert\; Q)\)</span> measures the extra bits needed to encode samples from <span class="math inline">\(P\)</span> using a code optimized for <span class="math inline">\(Q\)</span>. By minimizing this, we’re trying to make <span class="math inline">\(Q\)</span> as close as possible to <span class="math inline">\(P\)</span>:</p>
<p><span class="math display">\[ \begin{aligned}
\mathop{\mathrm{arg\,min}}\limits_Q\; D_{KL}(P \;\Vert\; Q) &amp;= \mathop{\mathrm{arg\,min}}\limits_Q\; H(P, Q) - H(P) \\[1ex]
&amp;= \mathop{\mathrm{arg\,min}}\limits_Q\; H(P, Q) &amp;&amp; \text{\small{(since $H(P)$ is constant w.r.t. $Q$)}} \\[1ex]
&amp;= \mathop{\mathrm{arg\,min}}\limits_Q\; -\sum\limits_{x \in X} p(x)\log{q(x)}
\end{aligned} \]</span></p>
<p>So basically minimizing the forward KL is equivalent to minimizing the cross-entropy between <span class="math inline">\(P\)</span> and <span class="math inline">\(Q\)</span>, a common objective in supervised classification problems. As we saw in <a href="#sec-zero-prob" class="quarto-xref">Section&nbsp;4.2</a>, this loss ladnscape is interesting around zero probabilities:</p>
<ul>
<li>If <span class="math inline">\(p(x) = 0\)</span> then <span class="math inline">\(q(x)\)</span> can be anything, because the loss is zero. The con of this is that it can lead to overconfident predictions in regions with little data.<br>
</li>
<li>If <span class="math inline">\(P(x) \gt 0\)</span> and <span class="math inline">\(Q(x) \le \epsilon\)</span>, then the loss becomes significanly large. As a consequence, <span class="math inline">\(Q\)</span> would rather assign a low probability to events that are very unlikely under <span class="math inline">\(P\)</span> than missing them entirely.</li>
</ul>
<p>In the interactive plot below you can see how the forward KL divergence changes as you adjust the mean and variance of the Gaussian distribution <span class="math inline">\(Q\)</span> (inspired by <span class="citation" data-cites="evjang2016_variational_bayes"><a href="#ref-evjang2016_variational_bayes" role="doc-biblioref">[3]</a></span>).</p>
<div class="column-body-outset" style="margin: 2em 0;" data-collapse="false">
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="2" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1;"><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>domain <span class="op">=</span> [<span class="op">-</span><span class="dv">5</span><span class="op">,</span> <span class="dv">5</span>]<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>meanRange <span class="op">=</span> [<span class="op">-</span><span class="dv">3</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>meanStep <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>varianceRange <span class="op">=</span> [<span class="fl">0.5</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>varianceStep <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>font_styles <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="vs">    .tick text {</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 12px;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="vs">    .plot-title {</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 18px; font-weight: bold;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="vs">    .axis-label {</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 16px;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="vs">    .tooltip-text {</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 16px; font-weight: bold;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Cell 1: Import libraries</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>Plot <span class="op">=</span> <span class="pp">require</span>(<span class="st">"@observablehq/plot"</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {slider} <span class="im">from</span> <span class="st">'@jashkenas/inputs'</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Cell 2: Input sliders</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>viewof mean <span class="op">=</span> <span class="fu">slider</span>({</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> meanRange[<span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> meanRange[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> meanStep<span class="op">,</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="op">-</span><span class="fl">1.4</span><span class="op">,</span> </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">"Mean"</span><span class="op">,</span> </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>viewof variance <span class="op">=</span> <span class="fu">slider</span>({</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> varianceRange[<span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> varianceRange[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> varianceStep<span class="op">,</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">1.5</span><span class="op">,</span> </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">"Variance"</span><span class="op">,</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co">// Static P distribution: Gaussian Mixture Model</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> <span class="fu">generateDataFromGMM</span>([</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">mean</span><span class="op">:</span> <span class="op">-</span><span class="fl">2.5</span><span class="op">,</span> <span class="dt">variance</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span> <span class="dt">weight</span><span class="op">:</span> <span class="fl">0.4</span>}<span class="op">,</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">mean</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">variance</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">weight</span><span class="op">:</span> <span class="fl">0.6</span>}</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="co">// Cell 3: Gaussian mixture function, data generation, and KL divergence calculation</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">gaussian</span>(x<span class="op">,</span> mean<span class="op">,</span> variance) {</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (<span class="dv">1</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> variance)) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(x <span class="op">-</span> mean<span class="op">,</span> <span class="dv">2</span>) <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> variance))<span class="op">;</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="co">// Define Gaussian Mixture Model for P</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">gaussianMixture</span>(x<span class="op">,</span> components) {</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">// components is an array of objects with {mean, variance, weight}</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> components<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> {mean<span class="op">,</span> variance<span class="op">,</span> weight}) <span class="kw">=&gt;</span> {</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sum <span class="op">+</span> weight <span class="op">*</span> <span class="fu">gaussian</span>(x<span class="op">,</span> mean<span class="op">,</span> variance)<span class="op">;</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">generateDataFromGMM</span>(components) {</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="fu">range</span>(domain[<span class="dv">0</span>]<span class="op">,</span> domain[<span class="dv">1</span>]<span class="op">,</span> <span class="fl">0.1</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> ({</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> x<span class="op">,</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> <span class="fu">gaussianMixture</span>(x<span class="op">,</span> components)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate data for Q (simple Gaussian)</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">generateData</span>(mean<span class="op">,</span> variance) {</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="fu">range</span>(domain[<span class="dv">0</span>]<span class="op">,</span> domain[<span class="dv">1</span>]<span class="op">,</span> <span class="fl">0.1</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> ({</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> x<span class="op">,</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> <span class="fu">gaussian</span>(x<span class="op">,</span> mean<span class="op">,</span> variance)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate KL divergence</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateKLDivergence</span>(P<span class="op">,</span> Q) {</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> P<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> p<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> q <span class="op">=</span> Q[i]<span class="op">;</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (p<span class="op">.</span><span class="at">y</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> q<span class="op">.</span><span class="at">y</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> sum <span class="op">+</span> p<span class="op">.</span><span class="at">y</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(p<span class="op">.</span><span class="at">y</span> <span class="op">/</span> q<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sum<span class="op">;</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="co">// Cell 4: Calculate KL divergence for contour plot</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateKLDivergenceGrid</span>(dist1<span class="op">,</span> meanRange<span class="op">,</span> varianceRange<span class="op">,</span> forward<span class="op">=</span><span class="kw">true</span>) {</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> grid <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>   <span class="kw">let</span> kl<span class="op">;</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (<span class="kw">let</span> m <span class="kw">of</span> meanRange) {</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> v <span class="kw">of</span> varianceRange) {</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> dist2 <span class="op">=</span> <span class="fu">generateData</span>(m<span class="op">,</span> v)<span class="op">;</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (forward) {</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>            kl <span class="op">=</span> <span class="fu">calculateKLDivergence</span>(dist1<span class="op">,</span> dist2)<span class="op">;</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>            kl <span class="op">=</span> <span class="fu">calculateKLDivergence</span>(dist2<span class="op">,</span> dist1)<span class="op">;</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        grid<span class="op">.</span><span class="fu">push</span>({<span class="dt">mean</span><span class="op">:</span> m<span class="op">,</span> <span class="dt">variance</span><span class="op">:</span> v<span class="op">,</span> <span class="dt">kl</span><span class="op">:</span> kl})<span class="op">;</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> grid<span class="op">;</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="co">// Cell 5: Create and update the Gaussian mixture model plot</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createGuassianPlot</span>(mean<span class="op">,</span> variance<span class="op">,</span> P) {</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">400</span><span class="op">;</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> {<span class="dt">top</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">60</span>}<span class="op">;</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataQ <span class="op">=</span> <span class="fu">generateData</span>(mean<span class="op">,</span> variance)<span class="op">;</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>(domain)</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span>])<span class="op">;</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>([<span class="op">...</span>P<span class="op">,</span> <span class="op">...</span>dataQ]<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)])</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> line <span class="op">=</span> d3<span class="op">.</span><span class="fu">line</span>()</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">x</span>(d <span class="kw">=&gt;</span> <span class="fu">x</span>(d<span class="op">.</span><span class="at">x</span>))</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">y</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">y</span>))<span class="op">;</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height])<span class="op">;</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add font</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"style"</span>)<span class="op">.</span><span class="fu">text</span>(font_styles)<span class="op">;</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>  <span class="co">// X-axis</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0,</span><span class="sc">${</span>height <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisBottom</span>(x))<span class="op">;</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Y-axis</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yAxis <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">,0)`</span>)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisLeft</span>(y))<span class="op">;</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>  <span class="co">// X-axis label</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"axis-label"</span>)</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> width <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> height)</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"X"</span>)<span class="op">;</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Y-axis label (centered and rotated)</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"axis-label"</span>)</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"rotate(-90)"</span>)</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span>height <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fl">17.5</span>)</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Probability Density"</span>)<span class="op">;</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Line for Q (interactive)</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pathQ <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"steelblue"</span>)</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Line for P (static GMM)</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">datum</span>(P)</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"orange"</span>)</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> line)<span class="op">;</span></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Legend</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legend <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>width <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span> <span class="op">-</span> <span class="dv">25</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"steelblue"</span>)<span class="op">;</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">25</span>)</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Q"</span>)<span class="op">;</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">25</span>)</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"orange"</span>)<span class="op">;</span></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">25</span>)</span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">40</span>)</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"P"</span>)<span class="op">;</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Update Q distribution</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>  y<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>([<span class="op">...</span>P<span class="op">,</span> <span class="op">...</span>dataQ]<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)])<span class="op">;</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>  yAxis<span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisLeft</span>(y))<span class="op">;</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>  pathQ<span class="op">.</span><span class="fu">datum</span>(dataQ)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> line)<span class="op">;</span></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a><span class="co">// Cell 6: Refactored KL divergence contour plot</span></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createklContourPlot</span>(mean<span class="op">,</span> variance<span class="op">,</span> klGrid<span class="op">,</span> cntTitle) {</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">400</span><span class="op">;</span></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> {<span class="dt">top</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">45</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">50</span>}<span class="op">;</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotWidth <span class="op">=</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span><span class="op">;</span></span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotHeight <span class="op">=</span> height <span class="op">-</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">;</span></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> uniqueMeans <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="kw">new</span> <span class="bu">Set</span>(klGrid<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">mean</span>)))<span class="op">;</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> uniqueVariances <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="kw">new</span> <span class="bu">Set</span>(klGrid<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">variance</span>)))<span class="op">;</span></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create 2D array of KL values</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> klValues <span class="op">=</span> uniqueVariances<span class="op">.</span><span class="fu">map</span>(v <span class="kw">=&gt;</span> </span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>    uniqueMeans<span class="op">.</span><span class="fu">map</span>(m <span class="kw">=&gt;</span> {</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> point <span class="op">=</span> klGrid<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">mean</span> <span class="op">===</span> m <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">variance</span> <span class="op">===</span> v)<span class="op">;</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> point <span class="op">?</span> point<span class="op">.</span><span class="at">kl</span> <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Scales</span></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>(d3<span class="op">.</span><span class="fu">extent</span>(uniqueMeans))</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> plotWidth])<span class="op">;</span></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>(d3<span class="op">.</span><span class="fu">extent</span>(uniqueVariances))</span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([plotHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colorScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleSequential</span>(d3<span class="op">.</span><span class="at">interpolateViridis</span>)</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>(d3<span class="op">.</span><span class="fu">extent</span>(klGrid<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">kl</span>))<span class="op">;</span></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Generate contours</span></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contours <span class="op">=</span> d3<span class="op">.</span><span class="fu">contours</span>()</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">size</span>([uniqueMeans<span class="op">.</span><span class="at">length</span><span class="op">,</span> uniqueVariances<span class="op">.</span><span class="at">length</span>])</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">thresholds</span>(<span class="dv">50</span>)</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>    (klValues<span class="op">.</span><span class="fu">flat</span>())<span class="op">;</span></span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create SVG element</span></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height])</span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto;"</span>)<span class="op">;</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add font</span></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"style"</span>)<span class="op">.</span><span class="fu">text</span>(font_styles)<span class="op">;</span></span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> g <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw contour paths</span></span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>  g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(contours)</span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">colorScale</span>(d<span class="op">.</span><span class="at">value</span>))</span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">geoPath</span>()</span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">projection</span>(d3<span class="op">.</span><span class="fu">geoTransform</span>({</span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>        <span class="dt">point</span><span class="op">:</span> <span class="kw">function</span>(x<span class="op">,</span> y) {</span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Projection mapping based on exact data grid size</span></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> scaleX <span class="op">=</span> plotWidth <span class="op">/</span> (uniqueMeans<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> scaleY <span class="op">=</span> plotHeight <span class="op">/</span> (uniqueVariances<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">stream</span><span class="op">.</span><span class="fu">point</span>(x <span class="op">*</span> scaleX<span class="op">,</span> plotHeight <span class="op">-</span> y <span class="op">*</span> scaleY)<span class="op">;</span>  <span class="co">// Corrected projection</span></span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>      }))</span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>  <span class="co">// X-axis</span></span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>  g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0,</span><span class="sc">${</span>plotHeight<span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisBottom</span>(xScale)<span class="op">.</span><span class="fu">ticks</span>(<span class="dv">10</span>))</span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"axis-label"</span>)</span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> plotWidth <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">40</span>)</span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"currentColor"</span>)</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Mean"</span>)<span class="op">;</span></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Y-axis (centered label and rotated)</span></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>  g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisLeft</span>(yScale)<span class="op">.</span><span class="fu">ticks</span>(<span class="dv">10</span>))</span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"axis-label"</span>)</span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"rotate(-90)"</span>)</span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span>plotHeight <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="op">-</span><span class="dv">35</span>)</span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"currentColor"</span>)</span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Variance"</span>)<span class="op">;</span></span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>   <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"plot-title"</span>)</span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>   <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> width <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>   <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">-</span> <span class="fl">32.5</span>)</span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>   <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>   <span class="op">.</span><span class="fu">html</span>(cntTitle)<span class="op">;</span></span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Function to update point dynamically</span></span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updatePoint</span>(mean<span class="op">,</span> variance) {</span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nearestPoint <span class="op">=</span> klGrid<span class="op">.</span><span class="fu">reduce</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> </span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>      (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(b<span class="op">.</span><span class="at">mean</span> <span class="op">-</span> mean) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(b<span class="op">.</span><span class="at">variance</span> <span class="op">-</span> variance) <span class="op">&lt;</span> </span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>       <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(a<span class="op">.</span><span class="at">mean</span> <span class="op">-</span> mean) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(a<span class="op">.</span><span class="at">variance</span> <span class="op">-</span> variance)) <span class="op">?</span> b <span class="op">:</span> a</span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>    g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".current-point, .kl-value"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>    g<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"current-point"</span>)</span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="fu">xScale</span>(mean))</span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="fu">yScale</span>(variance))</span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)</span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>    g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"tooltip-text"</span>)</span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScale</span>(mean))</span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fu">yScale</span>(variance) <span class="op">-</span> <span class="dv">10</span>)</span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"paint-order"</span><span class="op">,</span> <span class="st">"stroke"</span>)</span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(nearestPoint<span class="op">.</span><span class="at">kl</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updatePoint</span>(mean<span class="op">,</span> variance)<span class="op">;</span></span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">assign</span>(svg<span class="op">.</span><span class="fu">node</span>()<span class="op">,</span> {updatePoint})<span class="op">;</span></span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>klGrid <span class="op">=</span> <span class="fu">calculateKLDivergenceGrid</span>(</span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>    P<span class="op">,</span></span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">range</span>(meanRange[<span class="dv">0</span>]<span class="op">,</span> meanRange[<span class="dv">1</span>] <span class="op">+</span> meanStep<span class="op">,</span> meanStep)<span class="op">,</span></span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">range</span>(varianceRange[<span class="dv">0</span>]<span class="op">,</span> varianceRange[<span class="dv">1</span>] <span class="op">+</span> varianceStep<span class="op">,</span> varianceStep)<span class="op">,</span></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>    <span class="kw">true</span></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>gaussianPlot <span class="op">=</span> <span class="fu">createGuassianPlot</span>(mean<span class="op">,</span> variance<span class="op">,</span> P)<span class="op">;</span></span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>klContourPlot <span class="op">=</span> <span class="fu">createklContourPlot</span>(</span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">,</span> variance<span class="op">,</span> klGrid<span class="op">,</span></span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>    <span class="vs">`KL Divergence (&lt;tspan fill="orange"&gt;P&lt;/tspan&gt;, &lt;tspan fill="steelblue"&gt;Q&lt;/tspan&gt;) Contour Plot`</span></span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div style="display: flex; align-items: center; column-gap: 1em;"&gt;</span></span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a><span class="vs"> &lt;div style="flex-basis:50%"&gt;</span><span class="sc">${</span>gaussianPlot<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a><span class="vs"> &lt;div style="flex-basis:50%"&gt;</span><span class="sc">${</span>klContourPlot<span class="sc">}</span><span class="vs"> &lt;/div&gt;</span></span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-24" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
<p>As you can see, the minimum as achieved when <span class="math inline">\(Q\)</span> is spread out enough to capture the full support of <span class="math inline">\(P\)</span>. This is the <strong>mean-seeking</strong> behavior of the forward KL divergence.</p>
</section>
<section id="reverse-kl" class="level4 page-columns page-full">
<h4 data-anchor-id="reverse-kl"><strong>Reverse KL</strong></h4>
<p><span class="math inline">\(D_{KL}(Q \;\Vert\; P)\)</span> measures the extra bits needed to encode samples from <span class="math inline">\(Q\)</span> using a code optimized for <span class="math inline">\(P\)</span>. Similar to the <a href="#sec-zero-prob" class="quarto-xref">Section&nbsp;4.2</a> analysis:</p>
<ul>
<li>It penalizes distributions <span class="math inline">\(Q\)</span> that assign non-zero probability to regions where <span class="math inline">\(P\)</span> is zero, since we’re minizing <span class="math inline">\(q(x)\log{\frac{q(x)}{p(x)}}\)</span>. Conversely, it doesn’t penalize <span class="math inline">\(Q\)</span> for missing regions where <span class="math inline">\(P\)</span> has non-zero probability.</li>
<li>It tends to capturing the dominant mode of <span class="math inline">\(P\)</span> and ignoring the rest. This can be demonstrated by the following example.</li>
</ul>
<p>The plot below is same as the previous one, but this time the contour plot shows the reverse KL divergence.</p>
<div class="column-body-outset" style="margin: 2em 0;" data-collapse="false">
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="2" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1;"><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>viewof mean2 <span class="op">=</span> <span class="fu">slider</span>({</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> meanRange[<span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> meanRange[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> meanStep<span class="op">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="op">-</span><span class="fl">1.4</span><span class="op">,</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">"Mean"</span><span class="op">,</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>viewof variance2 <span class="op">=</span> <span class="fu">slider</span>({</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> varianceRange[<span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> varianceRange[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> varianceStep<span class="op">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">1.5</span><span class="op">,</span> </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">"Variance"</span><span class="op">,</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>klGrid2 <span class="op">=</span> <span class="fu">calculateKLDivergenceGrid</span>(</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    P<span class="op">,</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">range</span>(meanRange[<span class="dv">0</span>]<span class="op">,</span> meanRange[<span class="dv">1</span>] <span class="op">+</span> meanStep<span class="op">,</span> meanStep)<span class="op">,</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">range</span>(varianceRange[<span class="dv">0</span>]<span class="op">,</span> varianceRange[<span class="dv">1</span>] <span class="op">+</span> varianceStep<span class="op">,</span> varianceStep)<span class="op">,</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">false</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>gaussianPlot2 <span class="op">=</span> <span class="fu">createGuassianPlot</span>(mean2<span class="op">,</span> variance2<span class="op">,</span> P)<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>klContourPlot2 <span class="op">=</span> <span class="fu">createklContourPlot</span>(</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    mean2<span class="op">,</span> variance2<span class="op">,</span> klGrid2<span class="op">,</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="vs">`KL Divergence (&lt;tspan fill="steelblue"&gt;Q&lt;/tspan&gt;, &lt;tspan fill="orange"&gt;P&lt;/tspan&gt;) Contour Plot`</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div style="display: flex; align-items: center; column-gap: 1em;"&gt;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="vs"> &lt;div style="flex-basis:50%"&gt;</span><span class="sc">${</span>gaussianPlot2<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="vs"> &lt;div style="flex-basis:50%"&gt;</span><span class="sc">${</span>klContourPlot2<span class="sc">}</span><span class="vs"> &lt;/div&gt;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-6" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
<p>You can see how the minimum is achieved when <span class="math inline">\(Q\)</span> is concentrated around the dominant mode of <span class="math inline">\(P\)</span>. This is the <strong>mode-seeking/zero-forcing</strong> behavior of the reverse KL divergence <span class="citation" data-cites="jones2019_klqp"><a href="#ref-jones2019_klqp" role="doc-biblioref">[4]</a></span>, and makes it desirable in the context of density estimation and variational inference. My own intuition is that in these tasks we would rather find a tight, concentrated approximation and miss some modes, than spread out and place density in low-probability regions.</p>
</section>
</section>
<section id="relations-to-mutual-information" class="level3" data-number="4.4">
<h3 data-number="4.4" data-anchor-id="relations-to-mutual-information"><span class="header-section-number">4.4</span> Relations to Mutual Information</h3>
<p>Let <span class="math inline">\((X,Y)\)</span> be a pair of random variables with values over the space <span class="math inline">\({\mathcal {X}}\times {\mathcal {Y}}\)</span>. If their joint distribution is <span class="math inline">\({P_{(X,Y)}}\)</span> and the marginal distributions are <span class="math inline">\({P_{Y}}\)</span> and <span class="math inline">\({P_{Y}}\)</span>, the mutual information is defined as:</p>
<p><span id="eq-mutual-information"><span class="math display">\[{I(X;Y)=D_{\mathrm {KL} }(P_{(X,Y)}\|P_{X}P_{Y})} \tag{4}\]</span></span></p>
<p>Notice, as per property of the KL divergence that <span class="math inline">\(I(X;Y)\)</span> is equal to zero precisely when the joint distribution coincides with the product of the marginals, i.e.&nbsp;when <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are independent (and hence observing <span class="math inline">\(Y\)</span> tells you nothing about <span class="math inline">\(X\)</span>). Intuitively, <span class="math inline">\(I(X;Y)\)</span> is a measure of the price for encoding <span class="math inline">\((X,Y)\)</span> as a pair of independent random variables when in reality they may not be.</p>
<p>Mutual information can also be expressed using conditional entropy:</p>
<p><span class="math display">\[{I(X;Y) \equiv H(X) - H(X \vert Y)}\]</span></p>
<p><br> Check out this video for a more detailed explanation: <span class="citation" data-cites="james2021_mi_kl"><a href="#ref-james2021_mi_kl" role="doc-biblioref">[5]</a></span></p>
<p><br></p>
</section>
</section>
<section id="jensen-shannon-divergence" class="level2" data-number="5">
<h2 data-number="5" data-anchor-id="jensen-shannon-divergence"><span class="header-section-number">5</span> Jensen-Shannon Divergence</h2>
<p>JS divergence is a symmetric measure, derived from KL divergence, and it does satisfy the properties of a metric. It is defined as the average of the KL divergence from each distribution to the average of both distributions:</p>
<p><span id="eq-js-divergence"><span class="math display">\[{JS(P \;\Vert\; Q) = \frac{1}{2}KL(P \;\Vert\; M) + \frac{1}{2}KL(Q \;\Vert\; M)} \tag{5}\]</span></span></p>
<p>where <span class="math inline">\(M=\dfrac{1}{2} (P+Q)\)</span> is a mixture of <span class="math inline">\(P\)</span> and <span class="math inline">\(Q\)</span>.</p>
<p>The averaging process and the introduction of <span class="math inline">\(M\)</span> ensure that the divergence remains finite, even if one distribution assigns zero probability to an event that the other distribution assigns a positive probability.</p>
<p>This can be a desirable property in scenarios where you want a more stable and bounded measure of divergence. However, it also means that JS divergence is less sensitive to cases where one distribution completely ignores an event that the other considers possible.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-wiki2024_boltzmann_entropy" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline"><span>“Boltzmann’s entropy formula.”</span> <a href="https://en.wikipedia.org/wiki/Boltzmann%27s_entropy_formula" class="uri">https://en.wikipedia.org/wiki/Boltzmann%27s_entropy_formula</a>.</div>
</div>
<div id="ref-wiki2024_lhopitals_rule" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline"><span>“L’hôpital’s rule.”</span> <a href="https://en.wikipedia.org/wiki/L%27H%C3%B4pital%27s_rule" class="uri">https://en.wikipedia.org/wiki/L%27H%C3%B4pital%27s_rule</a>.</div>
</div>
<div id="ref-evjang2016_variational_bayes" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">E. Jang, <span>“A beginner’s guide to variational methods: Mean-field approximation.”</span> <a href="https://blog.evjang.com/2016/08/variational-bayes.html" class="uri">https://blog.evjang.com/2016/08/variational-bayes.html</a>, 2016.</div>
</div>
<div id="ref-jones2019_klqp" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">A. Jones, <span>“KL(q||p) is mode-seeking.”</span> <a href="https://andrewcharlesjones.github.io/journal/klqp.html" class="uri">https://andrewcharlesjones.github.io/journal/klqp.html</a>.</div>
</div>
<div id="ref-james2021_mi_kl" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div class="csl-right-inline">J. Explains, <span>“A RIDICULOUSLY AWESOME SUMMATION: Mutual information and kullback-leibler divergence.”</span> <a href="https://www.youtube.com/watch?v=RaTe3dhiqdE" class="uri">https://www.youtube.com/watch?v=RaTe3dhiqdE</a>, 2021.</div>
</div>
<div id="ref-le2017_reverse_forward_kl" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div><div class="csl-right-inline">T. A. Le, <span>“Reverse vs forward KL.”</span> <a href="https://www.tuananhle.co.uk/notes/reverse-forward-kl.html" class="uri">https://www.tuananhle.co.uk/notes/reverse-forward-kl.html</a>, 2017.</div>
</div>
<div id="ref-reddit2016_cross_entropy_vs_kl" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div><div class="csl-right-inline">Reddit, <span>“Why train with cross-entropy instead of KL divergence in classification?”</span> <a href="https://www.reddit.com/r/MachineLearning/comments/4mebvf/why_train_with_crossentropy_instead_of_kl/" class="uri">https://www.reddit.com/r/MachineLearning/comments/4mebvf/why_train_with_crossentropy_instead_of_kl/</a>, 2016.</div>
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{sarang2024,
  author = {Sarang, Nima},
  title = {My {Notes} on {Information} {Theory}},
  date = {2024-08-24},
  url = {https://www.nimasarang.com/blog/2024-08-24-information-theory/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-sarang2024" class="csl-entry quarto-appendix-citeas" role="listitem">
<div class="">N.
Sarang, <span>“My Notes on Information Theory.”</span> [Online].
Available: <a href="https://www.nimasarang.com/blog/2024-08-24-information-theory/">https://www.nimasarang.com/blog/2024-08-24-information-theory/</a></div>
</div></div></section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuZG9tYWluID0gWy01LCA1XTtcbm1lYW5SYW5nZSA9IFstMywgM107XG5tZWFuU3RlcCA9IDAuMTtcbnZhcmlhbmNlUmFuZ2UgPSBbMC41LCAzXTtcbnZhcmlhbmNlU3RlcCA9IDAuMTtcblxuZm9udF9zdHlsZXMgPSBgXG4gICAgLnRpY2sgdGV4dCB7XG4gICAgICAgIGZvbnQtc2l6ZTogMTJweDtcbiAgICB9XG4gICAgLnBsb3QtdGl0bGUge1xuICAgICAgICBmb250LXNpemU6IDE4cHg7IGZvbnQtd2VpZ2h0OiBib2xkO1xuICAgIH1cbiAgICAuYXhpcy1sYWJlbCB7XG4gICAgICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgICB9XG4gICAgLnRvb2x0aXAtdGV4dCB7XG4gICAgICAgIGZvbnQtc2l6ZTogMTZweDsgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgfVxuYDtcblxuXG4vLyBDZWxsIDE6IEltcG9ydCBsaWJyYXJpZXNcbmQzID0gcmVxdWlyZShcImQzXCIpXG5QbG90ID0gcmVxdWlyZShcIkBvYnNlcnZhYmxlaHEvcGxvdFwiKVxuaW1wb3J0IHtzbGlkZXJ9IGZyb20gJ0BqYXNoa2VuYXMvaW5wdXRzJ1xuXG4vLyBDZWxsIDI6IElucHV0IHNsaWRlcnNcbnZpZXdvZiBtZWFuID0gc2xpZGVyKHtcbiAgbWluOiBtZWFuUmFuZ2VbMF0sXG4gIG1heDogbWVhblJhbmdlWzFdLFxuICBzdGVwOiBtZWFuU3RlcCxcbiAgdmFsdWU6IC0xLjQsIFxuICB0aXRsZTogXCJNZWFuXCIsIFxufSlcbnZpZXdvZiB2YXJpYW5jZSA9IHNsaWRlcih7XG4gIG1pbjogdmFyaWFuY2VSYW5nZVswXSxcbiAgbWF4OiB2YXJpYW5jZVJhbmdlWzFdLFxuICBzdGVwOiB2YXJpYW5jZVN0ZXAsXG4gIHZhbHVlOiAxLjUsIFxuICB0aXRsZTogXCJWYXJpYW5jZVwiLFxufSlcblxuXG4vLyBTdGF0aWMgUCBkaXN0cmlidXRpb246IEdhdXNzaWFuIE1peHR1cmUgTW9kZWxcblAgPSBnZW5lcmF0ZURhdGFGcm9tR01NKFtcbiAge21lYW46IC0yLjUsIHZhcmlhbmNlOiAwLjMsIHdlaWdodDogMC40fSxcbiAge21lYW46IDIsIHZhcmlhbmNlOiAwLjUsIHdlaWdodDogMC42fVxuXSk7XG5cbi8vIENlbGwgMzogR2F1c3NpYW4gbWl4dHVyZSBmdW5jdGlvbiwgZGF0YSBnZW5lcmF0aW9uLCBhbmQgS0wgZGl2ZXJnZW5jZSBjYWxjdWxhdGlvblxuZnVuY3Rpb24gZ2F1c3NpYW4oeCwgbWVhbiwgdmFyaWFuY2UpIHtcbiAgcmV0dXJuICgxIC8gTWF0aC5zcXJ0KDIgKiBNYXRoLlBJICogdmFyaWFuY2UpKSAqIE1hdGguZXhwKC1NYXRoLnBvdyh4IC0gbWVhbiwgMikgLyAoMiAqIHZhcmlhbmNlKSk7XG59XG5cbi8vIERlZmluZSBHYXVzc2lhbiBNaXh0dXJlIE1vZGVsIGZvciBQXG5mdW5jdGlvbiBnYXVzc2lhbk1peHR1cmUoeCwgY29tcG9uZW50cykge1xuICAvLyBjb21wb25lbnRzIGlzIGFuIGFycmF5IG9mIG9iamVjdHMgd2l0aCB7bWVhbiwgdmFyaWFuY2UsIHdlaWdodH1cbiAgcmV0dXJuIGNvbXBvbmVudHMucmVkdWNlKChzdW0sIHttZWFuLCB2YXJpYW5jZSwgd2VpZ2h0fSkgPT4ge1xuICAgIHJldHVybiBzdW0gKyB3ZWlnaHQgKiBnYXVzc2lhbih4LCBtZWFuLCB2YXJpYW5jZSk7XG4gIH0sIDApO1xufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZURhdGFGcm9tR01NKGNvbXBvbmVudHMpIHtcbiAgcmV0dXJuIGQzLnJhbmdlKGRvbWFpblswXSwgZG9tYWluWzFdLCAwLjEpLm1hcCh4ID0+ICh7XG4gICAgeDogeCxcbiAgICB5OiBnYXVzc2lhbk1peHR1cmUoeCwgY29tcG9uZW50cylcbiAgfSkpO1xufVxuXG4vLyBHZW5lcmF0ZSBkYXRhIGZvciBRIChzaW1wbGUgR2F1c3NpYW4pXG5mdW5jdGlvbiBnZW5lcmF0ZURhdGEobWVhbiwgdmFyaWFuY2UpIHtcbiAgcmV0dXJuIGQzLnJhbmdlKGRvbWFpblswXSwgZG9tYWluWzFdLCAwLjEpLm1hcCh4ID0+ICh7XG4gICAgeDogeCxcbiAgICB5OiBnYXVzc2lhbih4LCBtZWFuLCB2YXJpYW5jZSlcbiAgfSkpO1xufVxuXG4vLyBDYWxjdWxhdGUgS0wgZGl2ZXJnZW5jZVxuZnVuY3Rpb24gY2FsY3VsYXRlS0xEaXZlcmdlbmNlKFAsIFEpIHtcbiAgcmV0dXJuIFAucmVkdWNlKChzdW0sIHAsIGkpID0+IHtcbiAgICBjb25zdCBxID0gUVtpXTtcbiAgICBpZiAocC55ID4gMCAmJiBxLnkgPiAwKSB7XG4gICAgICByZXR1cm4gc3VtICsgcC55ICogTWF0aC5sb2cocC55IC8gcS55KTtcbiAgICB9XG4gICAgcmV0dXJuIHN1bTtcbiAgfSwgMCk7XG59XG5cbi8vIENlbGwgNDogQ2FsY3VsYXRlIEtMIGRpdmVyZ2VuY2UgZm9yIGNvbnRvdXIgcGxvdFxuZnVuY3Rpb24gY2FsY3VsYXRlS0xEaXZlcmdlbmNlR3JpZChkaXN0MSwgbWVhblJhbmdlLCB2YXJpYW5jZVJhbmdlLCBmb3J3YXJkPXRydWUpIHtcbiAgIGNvbnN0IGdyaWQgPSBbXTtcbiAgIGxldCBrbDtcbiAgIGZvciAobGV0IG0gb2YgbWVhblJhbmdlKSB7XG4gICAgICBmb3IgKGxldCB2IG9mIHZhcmlhbmNlUmFuZ2UpIHtcbiAgICAgICAgY29uc3QgZGlzdDIgPSBnZW5lcmF0ZURhdGEobSwgdik7XG4gICAgICAgIGlmIChmb3J3YXJkKSB7XG4gICAgICAgICAgICBrbCA9IGNhbGN1bGF0ZUtMRGl2ZXJnZW5jZShkaXN0MSwgZGlzdDIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAga2wgPSBjYWxjdWxhdGVLTERpdmVyZ2VuY2UoZGlzdDIsIGRpc3QxKTtcbiAgICAgICAgfVxuICAgICAgICBncmlkLnB1c2goe21lYW46IG0sIHZhcmlhbmNlOiB2LCBrbDoga2x9KTtcbiAgICAgIH1cbiAgIH1cbiAgIHJldHVybiBncmlkO1xufVxuXG4vLyBDZWxsIDU6IENyZWF0ZSBhbmQgdXBkYXRlIHRoZSBHYXVzc2lhbiBtaXh0dXJlIG1vZGVsIHBsb3RcbmZ1bmN0aW9uIGNyZWF0ZUd1YXNzaWFuUGxvdChtZWFuLCB2YXJpYW5jZSwgUCkge1xuICBjb25zdCB3aWR0aCA9IDYwMDtcbiAgY29uc3QgaGVpZ2h0ID0gNDAwO1xuICBjb25zdCBtYXJnaW4gPSB7dG9wOiAyMCwgcmlnaHQ6IDIwLCBib3R0b206IDQwLCBsZWZ0OiA2MH07XG5cbiAgY29uc3QgZGF0YVEgPSBnZW5lcmF0ZURhdGEobWVhbiwgdmFyaWFuY2UpO1xuICBcbiAgY29uc3QgeCA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKGRvbWFpbilcbiAgICAucmFuZ2UoW21hcmdpbi5sZWZ0LCB3aWR0aCAtIG1hcmdpbi5yaWdodF0pO1xuXG4gIGNvbnN0IHkgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgZDMubWF4KFsuLi5QLCAuLi5kYXRhUV0sIGQgPT4gZC55KV0pXG4gICAgLnJhbmdlKFtoZWlnaHQgLSBtYXJnaW4uYm90dG9tLCBtYXJnaW4udG9wXSk7XG5cbiAgY29uc3QgbGluZSA9IGQzLmxpbmUoKVxuICAgIC54KGQgPT4geChkLngpKVxuICAgIC55KGQgPT4geShkLnkpKTtcblxuICBjb25zdCBzdmcgPSBkMy5jcmVhdGUoXCJzdmdcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHdpZHRoLCBoZWlnaHRdKTtcblxuICAvLyBBZGQgZm9udFxuICBzdmcuYXBwZW5kKFwic3R5bGVcIikudGV4dChmb250X3N0eWxlcyk7XG5cbiAgLy8gWC1heGlzXG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgwLCR7aGVpZ2h0IC0gbWFyZ2luLmJvdHRvbX0pYClcbiAgICAuY2FsbChkMy5heGlzQm90dG9tKHgpKTtcbiAgXG4gIC8vIFktYXhpc1xuICBjb25zdCB5QXhpcyA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0fSwwKWApXG4gICAgLmNhbGwoZDMuYXhpc0xlZnQoeSkpO1xuICBcbiAgLy8gWC1heGlzIGxhYmVsXG4gIHN2Zy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImF4aXMtbGFiZWxcIilcbiAgICAuYXR0cihcInhcIiwgd2lkdGggLyAyKVxuICAgIC5hdHRyKFwieVwiLCBoZWlnaHQpXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC50ZXh0KFwiWFwiKTtcblxuICAvLyBZLWF4aXMgbGFiZWwgKGNlbnRlcmVkIGFuZCByb3RhdGVkKVxuICBzdmcuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJheGlzLWxhYmVsXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJyb3RhdGUoLTkwKVwiKVxuICAgIC5hdHRyKFwieFwiLCAtaGVpZ2h0IC8gMilcbiAgICAuYXR0cihcInlcIiwgMTcuNSlcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgLnRleHQoXCJQcm9iYWJpbGl0eSBEZW5zaXR5XCIpO1xuXG4gIC8vIExpbmUgZm9yIFEgKGludGVyYWN0aXZlKVxuICBjb25zdCBwYXRoUSA9IHN2Zy5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwic3RlZWxibHVlXCIpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMik7XG4gIFxuICAvLyBMaW5lIGZvciBQIChzdGF0aWMgR01NKVxuICBzdmcuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5kYXR1bShQKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAuYXR0cihcInN0cm9rZVwiLCBcIm9yYW5nZVwiKVxuICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDIpXG4gICAgLmF0dHIoXCJkXCIsIGxpbmUpO1xuICBcbiAgLy8gTGVnZW5kXG4gIGNvbnN0IGxlZ2VuZCA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke3dpZHRoIC0gbWFyZ2luLnJpZ2h0IC0gMjV9LCR7bWFyZ2luLnRvcH0pYCk7XG4gIFxuICBsZWdlbmQuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgMjApXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgMjApXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwic3RlZWxibHVlXCIpO1xuICBcbiAgbGVnZW5kLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcInhcIiwgMjUpXG4gICAgLmF0dHIoXCJ5XCIsIDE1KVxuICAgIC50ZXh0KFwiUVwiKTtcbiAgXG4gIGxlZ2VuZC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ5XCIsIDI1KVxuICAgIC5hdHRyKFwid2lkdGhcIiwgMjApXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgMjApXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwib3JhbmdlXCIpO1xuICBcbiAgbGVnZW5kLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcInhcIiwgMjUpXG4gICAgLmF0dHIoXCJ5XCIsIDQwKVxuICAgIC50ZXh0KFwiUFwiKTtcblxuICAvLyBVcGRhdGUgUSBkaXN0cmlidXRpb25cbiAgeS5kb21haW4oWzAsIGQzLm1heChbLi4uUCwgLi4uZGF0YVFdLCBkID0+IGQueSldKTtcbiAgeUF4aXMuY2FsbChkMy5heGlzTGVmdCh5KSk7XG4gIHBhdGhRLmRhdHVtKGRhdGFRKS5hdHRyKFwiZFwiLCBsaW5lKTtcbiAgXG4gIHJldHVybiBzdmcubm9kZSgpO1xufVxuXG4vLyBDZWxsIDY6IFJlZmFjdG9yZWQgS0wgZGl2ZXJnZW5jZSBjb250b3VyIHBsb3RcbmZ1bmN0aW9uIGNyZWF0ZWtsQ29udG91clBsb3QobWVhbiwgdmFyaWFuY2UsIGtsR3JpZCwgY250VGl0bGUpIHtcbiAgY29uc3Qgd2lkdGggPSA2MDA7XG4gIGNvbnN0IGhlaWdodCA9IDQwMDtcbiAgY29uc3QgbWFyZ2luID0ge3RvcDogNTAsIHJpZ2h0OiAzMCwgYm90dG9tOiA0NSwgbGVmdDogNTB9O1xuICBjb25zdCBwbG90V2lkdGggPSB3aWR0aCAtIG1hcmdpbi5sZWZ0IC0gbWFyZ2luLnJpZ2h0O1xuICBjb25zdCBwbG90SGVpZ2h0ID0gaGVpZ2h0IC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b207XG5cbiAgY29uc3QgdW5pcXVlTWVhbnMgPSBBcnJheS5mcm9tKG5ldyBTZXQoa2xHcmlkLm1hcChkID0+IGQubWVhbikpKTtcbiAgY29uc3QgdW5pcXVlVmFyaWFuY2VzID0gQXJyYXkuZnJvbShuZXcgU2V0KGtsR3JpZC5tYXAoZCA9PiBkLnZhcmlhbmNlKSkpO1xuXG4gIC8vIENyZWF0ZSAyRCBhcnJheSBvZiBLTCB2YWx1ZXNcbiAgY29uc3Qga2xWYWx1ZXMgPSB1bmlxdWVWYXJpYW5jZXMubWFwKHYgPT4gXG4gICAgdW5pcXVlTWVhbnMubWFwKG0gPT4ge1xuICAgICAgY29uc3QgcG9pbnQgPSBrbEdyaWQuZmluZChkID0+IGQubWVhbiA9PT0gbSAmJiBkLnZhcmlhbmNlID09PSB2KTtcbiAgICAgIHJldHVybiBwb2ludCA/IHBvaW50LmtsIDogbnVsbDtcbiAgICB9KVxuICApO1xuXG4gIC8vIFNjYWxlc1xuICBjb25zdCB4U2NhbGUgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihkMy5leHRlbnQodW5pcXVlTWVhbnMpKVxuICAgIC5yYW5nZShbMCwgcGxvdFdpZHRoXSk7XG5cbiAgY29uc3QgeVNjYWxlID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oZDMuZXh0ZW50KHVuaXF1ZVZhcmlhbmNlcykpXG4gICAgLnJhbmdlKFtwbG90SGVpZ2h0LCAwXSk7XG5cbiAgY29uc3QgY29sb3JTY2FsZSA9IGQzLnNjYWxlU2VxdWVudGlhbChkMy5pbnRlcnBvbGF0ZVZpcmlkaXMpXG4gICAgLmRvbWFpbihkMy5leHRlbnQoa2xHcmlkLCBkID0+IGQua2wpKTtcbiAgXG4gIC8vIEdlbmVyYXRlIGNvbnRvdXJzXG4gIGNvbnN0IGNvbnRvdXJzID0gZDMuY29udG91cnMoKVxuICAgIC5zaXplKFt1bmlxdWVNZWFucy5sZW5ndGgsIHVuaXF1ZVZhcmlhbmNlcy5sZW5ndGhdKVxuICAgIC50aHJlc2hvbGRzKDUwKVxuICAgIChrbFZhbHVlcy5mbGF0KCkpO1xuXG4gIC8vIENyZWF0ZSBTVkcgZWxlbWVudFxuICBjb25zdCBzdmcgPSBkMy5jcmVhdGUoXCJzdmdcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHdpZHRoLCBoZWlnaHRdKVxuICAgIC5hdHRyKFwic3R5bGVcIiwgXCJtYXgtd2lkdGg6IDEwMCU7IGhlaWdodDogYXV0bztcIik7XG5cbiAgLy8gQWRkIGZvbnRcbiAgc3ZnLmFwcGVuZChcInN0eWxlXCIpLnRleHQoZm9udF9zdHlsZXMpO1xuXG4gIGNvbnN0IGcgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sJHttYXJnaW4udG9wfSlgKTtcblxuICAvLyBEcmF3IGNvbnRvdXIgcGF0aHNcbiAgZy5hcHBlbmQoXCJnXCIpXG4gICAgLnNlbGVjdEFsbChcInBhdGhcIilcbiAgICAuZGF0YShjb250b3VycylcbiAgICAuam9pbihcInBhdGhcIilcbiAgICAuYXR0cihcImZpbGxcIiwgZCA9PiBjb2xvclNjYWxlKGQudmFsdWUpKVxuICAgIC5hdHRyKFwiZFwiLCBkMy5nZW9QYXRoKClcbiAgICAgIC5wcm9qZWN0aW9uKGQzLmdlb1RyYW5zZm9ybSh7XG4gICAgICAgIHBvaW50OiBmdW5jdGlvbih4LCB5KSB7XG4gICAgICAgICAgLy8gUHJvamVjdGlvbiBtYXBwaW5nIGJhc2VkIG9uIGV4YWN0IGRhdGEgZ3JpZCBzaXplXG4gICAgICAgICAgY29uc3Qgc2NhbGVYID0gcGxvdFdpZHRoIC8gKHVuaXF1ZU1lYW5zLmxlbmd0aCAtIDEpO1xuICAgICAgICAgIGNvbnN0IHNjYWxlWSA9IHBsb3RIZWlnaHQgLyAodW5pcXVlVmFyaWFuY2VzLmxlbmd0aCAtIDEpO1xuICAgICAgICAgIHRoaXMuc3RyZWFtLnBvaW50KHggKiBzY2FsZVgsIHBsb3RIZWlnaHQgLSB5ICogc2NhbGVZKTsgIC8vIENvcnJlY3RlZCBwcm9qZWN0aW9uXG4gICAgICAgIH1cbiAgICAgIH0pKVxuICAgICk7XG5cbiAgLy8gWC1heGlzXG4gIGcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoMCwke3Bsb3RIZWlnaHR9KWApXG4gICAgLmNhbGwoZDMuYXhpc0JvdHRvbSh4U2NhbGUpLnRpY2tzKDEwKSlcbiAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJheGlzLWxhYmVsXCIpXG4gICAgLmF0dHIoXCJ4XCIsIHBsb3RXaWR0aCAvIDIpXG4gICAgLmF0dHIoXCJ5XCIsIDQwKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcImN1cnJlbnRDb2xvclwiKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAudGV4dChcIk1lYW5cIik7XG5cbiAgLy8gWS1heGlzIChjZW50ZXJlZCBsYWJlbCBhbmQgcm90YXRlZClcbiAgZy5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoZDMuYXhpc0xlZnQoeVNjYWxlKS50aWNrcygxMCkpXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiYXhpcy1sYWJlbFwiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwicm90YXRlKC05MClcIilcbiAgICAuYXR0cihcInhcIiwgLXBsb3RIZWlnaHQgLyAyKVxuICAgIC5hdHRyKFwieVwiLCAtMzUpXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcImN1cnJlbnRDb2xvclwiKVxuICAgIC50ZXh0KFwiVmFyaWFuY2VcIik7XG5cbiAgc3ZnLmFwcGVuZChcInRleHRcIilcbiAgIC5hdHRyKFwiY2xhc3NcIiwgXCJwbG90LXRpdGxlXCIpXG4gICAuYXR0cihcInhcIiwgd2lkdGggLyAyKVxuICAgLmF0dHIoXCJ5XCIsIG1hcmdpbi50b3AgLSAzMi41KVxuICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgLmh0bWwoY250VGl0bGUpO1xuXG4gIC8vIEZ1bmN0aW9uIHRvIHVwZGF0ZSBwb2ludCBkeW5hbWljYWxseVxuICBmdW5jdGlvbiB1cGRhdGVQb2ludChtZWFuLCB2YXJpYW5jZSkge1xuICAgIGNvbnN0IG5lYXJlc3RQb2ludCA9IGtsR3JpZC5yZWR1Y2UoKGEsIGIpID0+IFxuICAgICAgKE1hdGguYWJzKGIubWVhbiAtIG1lYW4pICsgTWF0aC5hYnMoYi52YXJpYW5jZSAtIHZhcmlhbmNlKSA8IFxuICAgICAgIE1hdGguYWJzKGEubWVhbiAtIG1lYW4pICsgTWF0aC5hYnMoYS52YXJpYW5jZSAtIHZhcmlhbmNlKSkgPyBiIDogYVxuICAgICk7XG5cbiAgICBnLnNlbGVjdEFsbChcIi5jdXJyZW50LXBvaW50LCAua2wtdmFsdWVcIikucmVtb3ZlKCk7XG5cbiAgICBnLmFwcGVuZChcImNpcmNsZVwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImN1cnJlbnQtcG9pbnRcIilcbiAgICAgIC5hdHRyKFwiY3hcIiwgeFNjYWxlKG1lYW4pKVxuICAgICAgLmF0dHIoXCJjeVwiLCB5U2NhbGUodmFyaWFuY2UpKVxuICAgICAgLmF0dHIoXCJyXCIsIDUpXG4gICAgICAuYXR0cihcImZpbGxcIiwgXCJyZWRcIilcbiAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwid2hpdGVcIik7XG5cbiAgICBnLmFwcGVuZChcInRleHRcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0b29sdGlwLXRleHRcIilcbiAgICAgIC5hdHRyKFwieFwiLCB4U2NhbGUobWVhbikpXG4gICAgICAuYXR0cihcInlcIiwgeVNjYWxlKHZhcmlhbmNlKSAtIDEwKVxuICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgLmF0dHIoXCJmaWxsXCIsIFwid2hpdGVcIilcbiAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiYmxhY2tcIilcbiAgICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDIpXG4gICAgICAuYXR0cihcInBhaW50LW9yZGVyXCIsIFwic3Ryb2tlXCIpXG4gICAgICAudGV4dChuZWFyZXN0UG9pbnQua2wudG9GaXhlZCgyKSk7XG4gIH1cblxuICB1cGRhdGVQb2ludChtZWFuLCB2YXJpYW5jZSk7XG5cbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24oc3ZnLm5vZGUoKSwge3VwZGF0ZVBvaW50fSk7XG59XG5cbmtsR3JpZCA9IGNhbGN1bGF0ZUtMRGl2ZXJnZW5jZUdyaWQoXG4gICAgUCxcbiAgICBkMy5yYW5nZShtZWFuUmFuZ2VbMF0sIG1lYW5SYW5nZVsxXSArIG1lYW5TdGVwLCBtZWFuU3RlcCksXG4gICAgZDMucmFuZ2UodmFyaWFuY2VSYW5nZVswXSwgdmFyaWFuY2VSYW5nZVsxXSArIHZhcmlhbmNlU3RlcCwgdmFyaWFuY2VTdGVwKSxcbiAgICB0cnVlXG4pO1xuZ2F1c3NpYW5QbG90ID0gY3JlYXRlR3Vhc3NpYW5QbG90KG1lYW4sIHZhcmlhbmNlLCBQKTtcbmtsQ29udG91clBsb3QgPSBjcmVhdGVrbENvbnRvdXJQbG90KFxuICAgIG1lYW4sIHZhcmlhbmNlLCBrbEdyaWQsXG4gICAgYEtMIERpdmVyZ2VuY2UgKDx0c3BhbiBmaWxsPVwib3JhbmdlXCI+UDwvdHNwYW4+LCA8dHNwYW4gZmlsbD1cInN0ZWVsYmx1ZVwiPlE8L3RzcGFuPikgQ29udG91ciBQbG90YFxuKTtcblxuaHRtbGA8ZGl2IHN0eWxlPVwiZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgY29sdW1uLWdhcDogMWVtO1wiPlxuIDxkaXYgc3R5bGU9XCJmbGV4LWJhc2lzOjUwJVwiPiR7Z2F1c3NpYW5QbG90fTwvZGl2PlxuIDxkaXYgc3R5bGU9XCJmbGV4LWJhc2lzOjUwJVwiPiR7a2xDb250b3VyUGxvdH0gPC9kaXY+XG48L2Rpdj5gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnZpZXdvZiBtZWFuMiA9IHNsaWRlcih7XG4gIG1pbjogbWVhblJhbmdlWzBdLFxuICBtYXg6IG1lYW5SYW5nZVsxXSxcbiAgc3RlcDogbWVhblN0ZXAsXG4gIHZhbHVlOiAtMS40LCBcbiAgdGl0bGU6IFwiTWVhblwiLCBcbn0pXG52aWV3b2YgdmFyaWFuY2UyID0gc2xpZGVyKHtcbiAgbWluOiB2YXJpYW5jZVJhbmdlWzBdLFxuICBtYXg6IHZhcmlhbmNlUmFuZ2VbMV0sXG4gIHN0ZXA6IHZhcmlhbmNlU3RlcCxcbiAgdmFsdWU6IDEuNSwgXG4gIHRpdGxlOiBcIlZhcmlhbmNlXCIsXG59KVxuXG5rbEdyaWQyID0gY2FsY3VsYXRlS0xEaXZlcmdlbmNlR3JpZChcbiAgICBQLFxuICAgIGQzLnJhbmdlKG1lYW5SYW5nZVswXSwgbWVhblJhbmdlWzFdICsgbWVhblN0ZXAsIG1lYW5TdGVwKSxcbiAgICBkMy5yYW5nZSh2YXJpYW5jZVJhbmdlWzBdLCB2YXJpYW5jZVJhbmdlWzFdICsgdmFyaWFuY2VTdGVwLCB2YXJpYW5jZVN0ZXApLFxuICAgIGZhbHNlXG4pO1xuZ2F1c3NpYW5QbG90MiA9IGNyZWF0ZUd1YXNzaWFuUGxvdChtZWFuMiwgdmFyaWFuY2UyLCBQKTtcbmtsQ29udG91clBsb3QyID0gY3JlYXRla2xDb250b3VyUGxvdChcbiAgICBtZWFuMiwgdmFyaWFuY2UyLCBrbEdyaWQyLFxuICAgIGBLTCBEaXZlcmdlbmNlICg8dHNwYW4gZmlsbD1cInN0ZWVsYmx1ZVwiPlE8L3RzcGFuPiwgPHRzcGFuIGZpbGw9XCJvcmFuZ2VcIj5QPC90c3Bhbj4pIENvbnRvdXIgUGxvdGBcbik7XG5cblxuaHRtbGA8ZGl2IHN0eWxlPVwiZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgY29sdW1uLWdhcDogMWVtO1wiPlxuIDxkaXYgc3R5bGU9XCJmbGV4LWJhc2lzOjUwJVwiPiR7Z2F1c3NpYW5QbG90Mn08L2Rpdj5cbiA8ZGl2IHN0eWxlPVwiZmxleC1iYXNpczo1MCVcIj4ke2tsQ29udG91clBsb3QyfSA8L2Rpdj5cbjwvZGl2PmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbWVhbicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd2YXJpYW5jZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdtZWFuMicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd2YXJpYW5jZTInKSJ9XX0=
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../blog/2024-08-24-information-theory";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/(?:www\.)?(nimasarang\.com)\/.*$");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="nsarang/nsarang.github.io" data-repo-id="R_kgDOMZYgPg" data-category="Announcements" data-category-id="DIC_kwDOMZYgPs4ChVIN" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="dark" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="dark">
<input type="hidden" id="giscus-alt-theme" value="light">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Nima Sarang</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>
async function loadBodyWhenReady() {
    while (!document.body.classList.contains('quarto-light') && !document.body.classList.contains('quarto-dark')) {
        await new Promise(resolve => setTimeout(resolve, 50));
    }
    setTimeout(() => {
        document.body.style.visibility = "visible";
    }, 50); // Adjust the delay to allow for the dark mode to be loaded
}
loadBodyWhenReady();
</script>




</body></html>